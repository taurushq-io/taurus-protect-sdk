syntax = "proto3";

package tgvalidatord;

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "google/protobuf/timestamp.proto";

import "currency.proto";

option java_package = "com.taurushq.sdk.protect.proto.v1";

option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
  info: {
    title: "tg-validatord blockchain service";
    version: "1.0";
    contact: {
      name: "tg-validatord blockchain service";
      url: "https://github.com/taurusgroup/tg-validatord";
      email: "development@taurusgroup.ch";
    };
  };
  consumes: "application/json";
  produces: "application/json";
  schemes: [HTTP, HTTPS];
  security_definitions: {
    security: {
      key: "Bearer";
      value: {
        type: TYPE_API_KEY;
        in: IN_HEADER;
        name: "Authorization";
      }
    }
  }
  security: {
    security_requirement: {
      key: "Bearer";
      value: {};
    }
  }
  responses: {
    key: "401";
    value: {
      description: "Returned when the user is not authenticated.";
    }
  }
  responses: {
    key: "403";
    value: {
      description: "Returned when the user is not authorized to access the resource.";
    }
  }
  responses: {
    key: "404";
    value: {
      description: "Returned when the resource does not exist.";
    }
  }
  responses: {
    key: "400",
    value: {
      description: "Returned when an argument is invalid. It is"
          " typically returned if one of the symbols is not available";
    }
  }
  responses: {
    key: "500",
    value: {
      description: "Returned when the service encountered an error."
    }
  }

};


message GetBlockchainsInfoReply {
  DOTBlockchainInfo dot = 1;
  EVMBlockchainInfo eth = 2 [deprecated = true, (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "DEPRECATED: use the evm field instead";}];
  EVMBlockchainInfo evm = 3;
}

message DOTBlockchainInfo {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{ \"currentEra\": \"906\", \"maxNominations\": \"16\" }"
  };

  uint64 currentEra = 1;
  uint64 maxNominations = 2;
  uint64 forkNumber = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
    description: "Set to 1 for AssetHub.";
  }];
  google.protobuf.Timestamp forkMigratedAt = 4 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
    description: "Empty when DOT hasn't migrated to AssetHub";
  }];
}

message EVMBlockchainInfo {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{ \"chainId\": \"1\" }"
  };

  uint64 chainId = 1;
}

message XTZBlockchainInfo {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{ \"currentCycle\": \"823\" }"
  };

  uint64 currentCycle = 1;
}

message GetBlockchainsRequest {
  string blockchain = 1;
  string network = 2;
  bool includeBlockHeight = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Include the current block height. Requires blockchain/network need to be specified.";}];
}

message GetBlockchainsReply {
  repeated BlockchainEntity blockchains = 1;
}

message BlockchainEntity {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
    example: "{\"symbol\": \"ETH\",\"name\": \"Ethereum\",\"baseCurrency\":         { \"name\": \"Ethereum\", \"symbol\": \"ETH\", \"coinTypeIndex\": \"60\", \"blockchain\": \"ETH\", \"decimals\": \"18\", \"isAccountBased\": true, \"enabled\": true, \"id\": \"33a7de6af505855d3062715ac4609736a60cf2779f03cd033e74590708c4f0d4\", \"displayName\": \"Ethereum - ETH - ETH\", \"type\": \"native\" },\"ethInfo\": {\"chainId\": \"1\"}, \"blackholeAddress\": \"0x0000000000000000000000000000000000000000\"}"
  };

  string symbol = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "symbol of the blockchain (e.g. BTC, ETH, FTM, Cosmos, ...)"}];
  string name = 2;
  Currency baseCurrency = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Base currency used to pay fees on this blockchain"}];

  DOTBlockchainInfo dotInfo = 4 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Info specific to the DOT blokchain"}];
  EVMBlockchainInfo ethInfo = 5 [deprecated = true, (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Info specific to the ETH blokchain";}];
  string network = 6;
  string chainId = 7;
  string blackholeAddress = 8 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Destination address used for cancel requests"}];
  uint64 confirmations = 9 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Number of blocks needed for a transaction to be considered as confirmed"}];
  uint64 blockHeight = 10 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Current block height"}];
  bool isLayer2Chain = 11 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "True indicates this is a Layer2 blockchain"}];
  string layer1Network = 12 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Underlying layer 1 blockchain network, only relevant when isLayer2Chain is true"}];
  XTZBlockchainInfo xtzInfo = 13 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Info specific to the XTZ blockchain"}];
}

service BlockchainService {

  rpc GetBlockchains(GetBlockchainsRequest) returns (GetBlockchainsReply) {
    option (google.api.http) = {
      get: "/api/rest/v1/blockchains"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "Get blockchain entities";
      description: "This endpoint returns all the enabled blockchains";
      tags: "Blockchain";
    };
  };

  rpc GetBlockchainsInfo(google.protobuf.Empty) returns (GetBlockchainsInfoReply) {
    option deprecated = true;
    option (google.api.http) = {
      get: "/api/rest/v1/blockchains/info"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      deprecated: true;
      summary: "Use /api/rest/v1/blockchains instead";
      description: "";
      tags: "Blockchain";
    };
  };

}
