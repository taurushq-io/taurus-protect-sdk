syntax = "proto3";
package tgvalidatord;

import "google/protobuf/timestamp.proto";
import "cursor.proto";
import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";
import "google/api/visibility.proto";
import "workflow.proto";

option java_package = "com.taurushq.sdk.protect.proto.v1";

message GetWorkflowsRequest {
  option (google.api.message_visibility).restriction = "INTERNAL";
  RequestCursor cursor = 1;
  message IDsFilter {
    repeated string values = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filter for specific workflows, identified by their UUIDs";}];
  }
  message WorkflowTypeAndStatesFilter {
    string workflowType = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filter for specific workflow types";}];
    repeated string states = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filters workflows by state, applicable only when a specific workflow type is set";}];
  }
  message WorkflowTypeAndStatusFilter {
    string workflowType = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filter for specific workflow types";}];
    string status = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filter on workflow status, can be 'active' or 'completed'";}];
  }
  oneof filter {
    IDsFilter ids = 2;
    string status = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filter on workflow status, can be 'active' or 'completed'";}];
    string workflowType = 4 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Filter for specific workflow types";}];
    WorkflowTypeAndStatesFilter workflowTypeAndStates = 5;
    WorkflowTypeAndStatusFilter workflowTypeAndStatus = 6;
  };
}

message GetAssetWorkflowsRequest {
  option (google.api.message_visibility).restriction = "INTERNAL";
  RequestCursor cursor = 1;
  string assetID = 2;
  oneof filter {
    string state = 3;
  }
}

message GetWorkflowsReply {
  option (google.api.message_visibility).restriction = "INTERNAL";
  repeated Workflow result = 1;
  ResponseCursor cursor = 2;
}

message GetWorkflowTrailsRequest {
  option (google.api.message_visibility).restriction = "INTERNAL";
  RequestCursor cursor = 1;
  string workflowID = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "The ID of the workflow to get trails for";}];
}

message GetWorkflowTrailsReply {
  option (google.api.message_visibility).restriction = "INTERNAL";
  repeated WorkflowTrail result = 1;
  ResponseCursor cursor = 2;
}

service WorkflowServiceNew {
  option (google.api.api_visibility).restriction = "INTERNAL";
  rpc GetWorkflows (GetWorkflowsRequest) returns (GetWorkflowsReply) {
    option (google.api.http) = {
      get: "/api/rest/v2/workflows"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "List workflows";
      description: "This endpoint returns a list of workflows";
      tags: "Workflows";
    };
  };

  rpc GetAssetWorkflows (GetAssetWorkflowsRequest) returns (GetWorkflowsReply) {
    option (google.api.http) = {
      get: "/api/rest/v2/workflows/assets/{assetID}"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "List workflows by assetid";
      description: "This endpoint returns a list of workflows for an assetID";
      tags: "Workflows";
    };
  };

  rpc GetWorkflowTrails (GetWorkflowTrailsRequest) returns (GetWorkflowTrailsReply) {
    option (google.api.http) = {
      get: "/api/rest/v2/workflows/{workflowID}/trails"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
      summary: "List workflow trails";
      description: "This endpoint returns a list of workflow trails for a specific workflow";
      tags: "Workflows";
    };
  };

}